<blueprint default-activation="eager"
           xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">

    <!-- Get Hazelcast from Cellar -->
    <reference id="cacheservice" interface="com.hazelcast.core.HazelcastInstance"/>

    <reference id="persistenceUser" interface="bi.meteorite.core.api.persistence.UserService"/>

    <reference id="persistenceEvent" interface="bi.meteorite.core.api.persistence.EventService"/>

    <!-- JAAS Realm for user management -->
    <reference id="realm" interface="org.apache.karaf.jaas.config.JaasRealm"/>

    <!-- Backing Engine Service -->
    <bean id="engineService" class="org.apache.karaf.jaas.modules.BackingEngineService">
        <property name="engineFactories" ref="engineFactories"/>
    </bean>

    <!-- Backing Engine Factories -->
    <reference-list id="engineFactories" interface="org.apache.karaf.jaas.modules.BackingEngineFactory"
                    availability="optional"/>

    <bean id="cacheManagerTokenStore" class="bi.meteorite.core.security.tokenprovider.CacheManagerTokenStore"
          init-method="init">
        <property name="bcontext" ref="blueprintBundleContext"/>
        <property name="cacheManagerService" ref="cacheservice"/>
    </bean>
    <bean id="tokenProvider" class="bi.meteorite.core.security.tokenprovider.TokenProviderImpl">
        <property name="mtokenStore" ref="cacheManagerTokenStore"/>
    </bean>

    <bean id="loginService" class="bi.meteorite.core.security.jaas.JaasLoginManager">
        <property name="realm" value="karaf"/>
    </bean>

    <bean id="userManager" class="bi.meteorite.core.security.jaas.JaasUserManager">
        <property name="backingEngineService" ref="engineService"/>
        <property name="realm" ref="realm"/>
        <property name="userService" ref="persistenceUser"/>
    </bean>



    <bean id="defaultUsers" class="bi.meteorite.core.security.hibernate.DefaultUsers">
        <property name="userService" ref="persistenceUser"/>
        <property name="eventService" ref="persistenceEvent"/>
    </bean>

    <!-- Service objects -->

    <service ref="tokenProvider" interface="bi.meteorite.core.api.security.tokenprovider.TokenProvider"/>

    <service ref="loginService" interface="bi.meteorite.core.api.security.AdminLoginService"/>

    <service ref="userManager" interface="bi.meteorite.core.api.security.IUserManagementProvider"/>


</blueprint>